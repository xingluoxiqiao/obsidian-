操作系统是一组控制和管理计算机软硬件资源、合理地对各类作业进行调度以及方便用户使用的程序集合。
操作系统是位于硬件层(HAL)之上，所有其它系统软件层之下的一个系统软件，使得管理系统中的各种软件和硬件资源得以充分利用，方便用户使用计算机系统。

目标：
方便，有效（**提高系统资源利用率提高系统的吞吐量**），可扩展，开放

作用：
1.作为用户与计算机硬件系统之间的接口
2.作为计算机系统资源的管理者
3.用作扩充机器

发展过程：
无操作系统
单道批处理操作系统
多道批处理操作系统
分时操作系统(time-sharing system) 
实时操作系统(real time system)
1、单道批处理系统主要特征：自动性、顺序性、单道性。
2、单道批处理系统主要优点：减少人工操作，解决了作业的自动接续。
3、单道批处理系统主要缺点：平均周转时间长，没有交互能力。

多道程序的概念： 在内存中存放多道作业运行，运行结束或出错，自动调度内存中的另一道作业运行。
●多道程序带来的好处：
1、提高CPU的利用率。
2、提高内存和I/O设备利用率。
3、增加系统吞吐率。
多道批处理系统主要特征： 多道性、无序性、调度性（进程调度和作业调度）
多道批处理的主要优点：提高了资源利用率和吞吐能力
多道批处理的主要缺点：平均周转时间长，没有交互能力
多道批处理系统需要解决的5个问题
1、处理机管理：分配和控制CPU
2、存储器管理：内存分配与回收
3、I/O设备管理：I/O设备的分配与操纵
4、文件管理：文件的存取、共享和保护
5、作业管理：如何组织作业运行
分时系统：
人机交互、共享主机、便于用户上机
及时接收，及时处理
多路，独立，及时，交互


OS四个基本特征：
**并发**，共享，虚拟，异步
并发是最重要的特征，其它特征都以并发为前提。


**并发**——并行性和并发性，并发执行的过程。
- 并行性：是指两个或多个事件在同一时刻发生。	
- 并发性：是指两个或多个事件在同一时间间隔内发生。
任务共行
 - 从宏观上看，任务共行是指系统中有多个任务同时运行
 - 从微观上看，任务共行是指单处理机系统中的任务并发（Task Concurrency：即多个任务在单个处理机上交替运行）或多处理机系统中的任务并行（Task Parallelism：即多个任务在多个处理机上同时运行）。
引入进程
程序：静态实体
进程：系统中能独立运行并作为资源分配的基本单位，由一组机器指令、数据和堆栈等组成的独立运行的活动实体。
引入线程
进程作为资源分配的基本单位
线程作为独立运行和调度的基本单位


**共享**：是指系统中的资源可供内存中多个并发执行的进程共同使用。
1、互斥共享方式：
   - 把在一段时间内只允许一个进程访问的资源，称为临界资源。如打印机、栈、表格等
   - 系统中的临界资源可以提供给多个进程使用，但一段时间内仅允许一个进程使用，称为互斥共享方式。
2.同时访问方式： 
- 从宏观上看，资源共享是指多个任务可以同时使用系统中的软硬件资源。
- 从微观上看，多个进程交替互斥地使用系统中的某个资源。例如磁盘。
**并发和共享是操作系统的两个最基本的特征，它们又是互为存在的条件**

**虚拟**：是指通过某种技术把一个物理实体变为（映射为）若干个逻辑上的对应物。
时分复用，空分复用

**异步性**，多道程序环境下程序（进程）以异步的方式执行，每道程序在何时执行、各自执行的顺序、完成时间都是不确定的，也是不可预知的。
 **导致执行结果不确定，程序不可再现。**


操作系统的主要任务：
为多道程序的运行提供良好的运行环境，以保证多道程序能有条不紊地、高效地运行，并能最大程度地提高系统中各种资源的利用率和方便用户的使用。
操作系统应具有五方面的功能：
1、处理机管理（CPU）
2、存储器管理
3、设备管理
4、文件管理
5、用户接口

**处理机管理**：
主要功能 ：按照一定的算法把处理机分配给进程（线程），并对其进行有效的管理和控制。 
（1） **进程控制**
（2） **进程同步和互斥**
         ①进程互斥方式
         ②进程同步方式
（3） **进程通信** 
（4） **进程调度**

**存储器管理：**
为多道程序的运行提供良好的环境，方便用户使用存储器，提高存储器的利用率以及能从逻辑上扩充内存。 
（1）内存分配
（2）内存保护
（3）地址映射
（4）内存扩充

**设备管理：**
完成用户进程提出的I/O请求；为用户进程分配其所需的I/O设备；提高CPU和I/O设备的利用率；提高I/O速度；方便用户使用I/O设备。
（1）**缓冲管理**：有效地缓和CPU和I/O设备速度不匹配的矛盾 ，提高CPU的利用率。
（2）**设备分配**：根据I/O请求，分配其所需的设备。
（3）**设备处理**：设备处理程序又称为设备驱动程序。

**文件管理：**
对用户文件和系统文件进行管理，以方便用户使用，并保证文件的安全性。 
（1）文件存储空间的管理
（2）目录管理
（3）文件的读／写管理和保护

**用户接口：**
计算机用户需要的用户命令  
由OS实现的所有用户命令所构成的集合常被人们称为OS的Interface(用户接口)；有时也称为命令接口。
应用软件需要的System Call(系统调用) 
由OS实现的所有系统调用所构成的集合被人们称为程序接口或应用编程接口(Application Programming Interface,API)。


操作系统结构：
无结构，
模块化，
层次式，程序嵌套，运行频率，公用模块，用户接口
微内核



程序顺序执行：顺序性，封闭性，可再现性
程序并发执行：间断性，失去封闭性，不可再现性（程序经过多次执行后，虽然它们执行时的环境和初始条件相同，但得到的结果却各不相同）

典型的**进程定义**有：
（1）进程是程序的一次执行。
（2）进程是一个程序及其数据在处理机上顺序执行时所发生的活动。
（3）进程是程序在一个数据集合上运行的过程，它是系统进行资源分配和调度的一个独立单位。
**进程的特征** :
1）**结构特征**
为使程序（含数据）能独立运行，应为之配置一进程控制块，即PCB(Process Control Block)；
而由程序段、相关的数据段和PCB三部分便构成了进程实体。
所谓创建进程，实质上是创建进程实体中的PCB；而撤消进程，实质上是撤消进程的PCB。   
2）**动态性**
进程的实质是进程实体的一次执行过程，因此，动态性是进程的最基本的特征。
动态性表现：“它由创建而产生，由调度而执行，由撤消而消亡”。可见，进程实体有一定的生命期。
程序是一组有序指令的集合，其本身并不具有运动的含义，因而是静态的。
 3）**并发性**：这是指多个进程实体同存于内存中，且能在一段时间内同时运行。
 4）**独立性**：指进程实体是一个能独立运行、独立分配资源和独立接受调度的基本单位；
 5）**异步性**：指进程按各自独立的、不可预知的速度向前推进，或说进程实体按异步方式运行。

进程的三种基本状态：
就绪，阻塞，执行（新，退出）
![[Pasted image 20230418181205.png]]

交换技术：
将内存中暂时不能运行的进程，或暂时不用的数据和程序，换出到外存，以腾出足够的内存空间，把已具备运行条件的进程，或进程所需要的数据和程序，换入内存。
进程被交换到外存，状态变为**挂起状态**（使执行的进程暂停执行、静止下来）
1）引入挂起状态的原因：
终端用户的请求。
父进程请求。   
负荷调节的需要。当实时系统中的工作负荷较重，把一些不重要的进程挂起，以保证系统能正常运行。
操作系统的需要。操作系统有时希望挂起某些进程，以便检查运行中的资源使用情况或进行记账。 
2）被挂起进程的特征
不能立即执行
可能是等待某事件发生，若是，则阻塞条件独立于挂起条件，即使阻塞事件发生，该进程也不能执行
使之挂起的进程为：自身、其父进程、OS
只有挂起它的进程才能使之由挂起状态转换为其他状态

PCB是进程存在的唯一标志，常驻内存
进程控制块中的信息：
 1）进程标识符   内部，外部
 2）处理机状态   通用寄存器，指令计数器，程序状态字，用户栈指针
 3）进程调度信息  进程状态，进程优先级，进程调度所需的其他信息，阻塞原因
 4）进程控制信息  程序和数据的地址，进程同步和通信机制，资源清单，链接指针

PCB的组织方式：线性，链接，索引


进程控制是用于创建一个新进程，终止一个已完成的进程，或去终止一个因出现某事件而使其无法运行下去的进程，还负责进程运行中的状态转换。
进程控制一般是由OS的内核（常驻内存）中的原语(Primitive)来实现的。

进程图是用于描述一个进程的家族关系的有向树。
子进程可以继承父进程所拥有的资源。
当子进程被撤消时，应将其从父进程那里获得的资源归还给父进程。 
在撤消父进程时，也必须同时撤消其所有的子进程。

导致一个进程去创建另一个进程的典型事件，可有以下四类：
（1）用户登录     （2）作业调度
（3）提供服务     （4）应用请求

UNIX&Linux中创建进程的方式：
在shell中执行命令或可执行文件，由shell进程调用fork函数创建子进程
在代码中（已经存在的进程中）调用fork 函数创建子进程
fork创建的进程为子进程，原进程为父进程
fork函数被正确调用后，将会在子进程中和父进程中分别返回！！
在子进程中返回值为0（不合法的PID，提示当前运行在子进程中）
在父进程中返回值为子进程ID（让父进程掌握所创建子进程的ID号）
出错返回-1


putenv ( )函数将环境变量字符串放入环境变量表中；若该字符串已经存在，则覆盖
头文件stdlib.h
int putenv(char *str);

setenv ( )将指定环境变量的值设置为参数指定值（更改环境变量字符串）
头文件：stdlib.h
int setenv(const char* name,const char* value, int rewrite);
若name已经存在：
rewrite不等于0，则删除其原先的定义
rewrite等于0，则不删除其原先的定义

unsetenv ( )删除指定的环境变量字符串
头文件：stdlib.h
int unsetenv(const char* name); 

Linux 下进程的退出方式分为正常退出和异常退出两种
 (1)正常退出 
在 main 函数中执行 return
调用 exit 函数
调用_exit 函数。
exit 函数与_exit 函数的最大区别在于，exit 函数在调用 exit 系统之前要检查文件的打开 

 (2)异常退出
调用 abort 函数
进程收到某个信号，而该信号使程序终止



进程同步的主要任务：是使并发执行的诸进程之间能有效地共享资源和相互合作，从而使程序的执行具有可再现性。
1）间接相互制约关系。由于资源共享
2）直接相互制约关系。主要由于进程间的合作。 
一次仅允许一个进程访问的资源为临界资源 。（生产者-消费者问题）
把在每个进程中访问临界资源的那段代码称为临界区。

同步机制应遵循的规则
1)空闲让进2)忙则等待3)有限等待4)让权等待
