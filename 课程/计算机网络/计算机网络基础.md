TCP/IP网络模型：应用，传输，网络，网际接口
一个数据包每经过一层都会经历一次封装
![[Pasted image 20231225144613.png]]
网络接口层的传输单位是帧（frame），IP 层的传输单位是包（packet），TCP 层的传输单位是段（segment），HTTP 的传输单位则是消息或报文（message）。但这些名词并没有什么本质的区分，可以统称为数据包

消息的传输流程
1.浏览器对url进行解析，确定 Web 服务器和文件名，生产http请求信息
2.DNS查询服务器域名对应的 IP 地址（缓存）![[Pasted image 20231225144918.png]]
3.TCP附加报文头部，请求过长（超出MSS），会拆解报文
![[Pasted image 20231225145040.png]]
4.IP附加报文头部
5.MAC附加报文头部
在 MAC 包头里需要发送方 MAC 地址和接收方目标 MAC 地址，用于两点之间的传输
接收方MAC地址的获取通过ARP协议，在以太网中以**广播**的形式获取对应的MAC，并缓存到ARP缓存中（只有第一次需要进行广播）
5.网卡驱动获取网络包之后，会将其**复制**到网卡内的缓存区中，接着会在其开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列
网卡会将包转为电信号，通过网线发送出去
6.交换机根据 MAC 地址表查找 MAC 地址，然后将信号发送到相应的端口
没找到对应的MAC地址，将包转发到除了源端口之外的所有端口上，无论该设备连接在哪个端口上都能收到这个包
7.路由器查表转发数据包
路由器和交换机的区别：
路由器的各个端口都具有 MAC 地址和 IP 地址，交换机的端口不具有 MAC 地址
路由器类似于网卡，在各个路由器的转发过程中，会丢弃MAC头部，并附加新的MAC头部
这样在转发过程中，MAC地址是一直变化的，不变的是源 IP 和目标 IP
8.数据包到达服务器端，服务器端一步步解析并删除各层的头部，得到最终的报文
返回的报文也是这样通过每层增加头部最后发送到网络中，传输到浏览器
