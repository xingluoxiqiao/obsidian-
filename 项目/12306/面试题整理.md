快手校招一面：
**为什么会选择做 12306 这个项目？**
兴趣+gitee+学习方法+解决问题
**为什么要用设计模式？不用有什么问题？责任链模式优点是什么？**
代码复用+可扩展+可维护
便于代码的解耦，参数验证如果全放在一个方法中不容易梳理清晰，可读性较差
**12306 列车数据搜索用的 ElasticSearch 么？**
redis
**为什么列车数据搜索使用 Redis 而不是 ElasticSearch？**
性能，部署成本，可扩展性
**列车站点余票如何保证实时？**
展示的界面不一定是实时的，只能保证最终一致性
但是不会出现超卖问题，因为有令牌校验机制+分布式锁
**如何解决用户注册缓存穿透问题？**
缓存穿透：访问不存在的对象
布隆过滤器筛选：布隆过滤器中不存在说明是可以注册的，后面还有reuse缓存，如果缓存中有可以直接用，避免了直接访问数据库
**为什么不用缓存双删来解决数据库和缓存的一致性？**
第二次删除的时间是不可控的，可能出现不一致的情况
**多人购票选座算法是怎么实现的？（没写高铁在线购票，仅写了火车）**

 **如何保障购票时系统承载高并发而不出问题？**
分布式架构、数据库优化（分库分表，缓存，消息队列，分布式锁）、异步消息队列（削峰）、定时任务、负载均衡和高可用
 **为什么要分库分表？分库分表会带来什么问题？订单数据分库分表容量如何评估？**
分库分表是一种数据库水平切分的策略，用于**解决大规模数据量和高并发访问**的问题。它的目的是将数据分散存储在多个数据库实例或表中，以提高系统的性能、扩展性和可用性。以下是一些分库分表的优势以及可能带来的问题：
**优势：**
1. **提高性能：** 分库分表可以减轻单个数据库实例的负担，降低数据库服务器的压力，提高查询性能。
2. **提高可扩展性：** 可以水平扩展数据库，通过增加数据库实例或表的数量，从而适应不断增长的数据量。
3. **提高可用性：** 分库分表可以提高系统的可用性，因为一个库或表的故障不会影响到其他库或表。
4. **降低备份恢复时间：** 数据库备份和恢复的时间更短，因为每个库或表的数据量更小。
**可能带来的问题：**
1. **业务复杂度增加：** 分库分表引入了数据库水平切分的复杂性，需要考虑跨库事务、数据一致性等问题，增加了系统设计和维护的难度。
2. **查询复杂性：** 针对分库分表的查询可能变得更加复杂，需要涉及多个数据库实例或表，对于一些复杂查询可能需要在应用层进行处理。    
3. **数据迁移和维护：** 数据库的水平扩展可能需要进行数据迁移，维护工作也可能变得更加复杂。
4. **资源浪费：** 对于某些表，如果数据量不是很大，分库分表可能会导致资源浪费，因为每个库或表都需要一定的资源。

### 订单数据分库分表容量评估：

对于订单数据分库分表，容量评估是非常关键的，可以通过以下步骤进行：

1. **业务需求：** 确定业务需求，包括订单的预计数量、访问频率、数据增长速度等。
    
2. **数据分析：** 分析订单数据的特性，包括订单的大小、字段数量、查询模式等。
    
3. **分库分表方案：** 根据数据分析结果，选择合适的分库分表策略，例如按照订单ID范围、按照时间范围等进行划分。
    
4. **预估数据量：** 根据订单的预计数量和数据增长速度，预估每个库或表的数据量。
    
5. **硬件和性能测试：** 根据预估的数据量，进行硬件和性能测试，评估数据库服务器的性能是否满足要求。
    
6. **监测和调整：** 部署系统后，进行实时监测，根据实际数据变化和访问模式进行调整。
 **订单按照用户 ID 分片，那乘车人如何查询本人车票？**

理想汽车一面：
平常都用过哪些设计模式？应用场景是什么？
数据库与缓存一致性如何保证？
12306 数据如何存储？
介绍一下 ShardingSphere
读写分离能不能解决海量数据的问题？
没有分担写的问题
项目中最大的收获是什么？

小红书提前批：
 项目用的 Dubbo 还是 SpringCloud？Http 和 RPC 有什么区别？
 RocketMQ 如何保证消息不丢失？
 RocketMQ 如何保证消息不被重复消费？
 12306 缓存和数据库一致性如何实现？
 订单号如何保证全局唯一？
 12306 订单分库分表如何拆分？遇到热点表问题如何解决？

宁德时代：
能不能用定时任务延迟关闭订单？有什么问题？
数据库与缓存一致性是怎么保证的？缓存双删和 BinLog 更新有什么区别？
如何防止注册用户时缓存击穿问题？布隆过滤器的误判怎么解决的？
除了用布隆过滤器，还有没有其他解决方案？
为什么不用 Kafka 或者 RabbitMQ？
RocketMQ 如何防止消息丢失？
RocketMQ 消息积压如何解决？
RocketMQ 如何防止消息重复消费？
为什么要使用限流？解决了什么问题？限流组件中为什么不用 Hystrix？
限流的原理是什么？
为什么要分库分表？
用户是根据什么分库分表的？
订单如何分库分表？
乘车人如何查询自己的订单？
为什么要使用复合分片算法？原理是什么？
分布式数据库了不了解？

快手提前批：
12306 有没有抢票流程？
用户在购票时一定是 12306 有余票吗？
有没有考虑被刷单的情况，恶意提单？
有设计防刷系统吗？恶意提单，脚本刷票进行风控，在用户管理这一块有考虑过吗？
比如说同一个 IP 一直请求服务？
有没有提供检索功能，比如北京到杭州，要有北京西到杭州西，北京东到杭州东，北京西到杭州东？
Redis 是什么结构，比如北京到杭州出现北京西到杭州西，北京东到杭州东，北京西到杭州东？
分布式锁是怎么做的购票抢票，setnx 的缺点？

阿里淘天：
讲一下自己的项目，Rocketmq实现延迟消息的细节，有没有其他的方案
RocketMQ 消费失败，怎么保证可用性？
缓存穿透、缓存击穿、缓存雪崩，讲一下三个场景如何解决？
热点数据设置永不过期会将 Redis 爆内存，有没有其他的解决方案？
为什么用分布式锁构建缓存，不用分布式可以吗？
布隆过滤器的作用？
如何监听 Binlog 实现数据库和缓存之间的一致性，实时性如何？
Binlog 一般用于删除缓存的数据，不是更新缓存？
扣减库存如何保证不出现超卖问题？
秒杀场景，有没有更高性能的方案，CAS，版本号记录，不打到数据库，将库存放到缓存中，然后用 Lua 脚本实现库存扣减，秒杀商品缓存预热？
分库分表是如何实现的，基因复合算法，异地多活问题，比如在上海和杭州部署了两个节点，大部分请求只打到上海该怎么解决？

用友网络：
 Binlog 配合 RocketMQ 保证数据一致性是怎么做的？
 有没有做防止超卖？怎么做的？
 令牌限流是怎么做的？
 项目是哪来的？负责了什么部分？
 讲一下封装缓存组件避免用户注册？
 布隆过滤器是怎么用的？是只针对用户名吗？
 详细介绍布隆过滤器？
 讲一下缓存穿透？
 怎么保证不超卖？
 哈希存储的是什么结构？
 北京南-南京中途站点怎么扣减？
 怎么保证缓存与数据库的一性？
 RocketMQ 用到了哪些地方？
 支付宝回调是怎么处理的？
 讲一下订单号和用户分片算法。
 是完全依赖 ShardingSphere 的吗？

美团：
 项目中的难点？讲了 Canal + MQ 的和订单和座位表的流程
 Redis 中存的是什么？第二个流程中
 为什么用 Hash 结构？
 Redis 的其他数据结构？
 在用户模块中用到了 Set 怎么用的？
 布隆过滤器的特点，为什么可能在，在和不在什么情况下可以相信？
 12306 的列车余票怎么防止超卖？
 Redis 是用的单点还是集群？有了解过单机出现问题怎么办？
 主从节点 + Sentinel 怎么发现主节点挂了，还了解其他 Redis 集群吗？Redis Cluster 什么情况下会用？
 当 QPS 达到多少时有技术选型？有概念吗？
 分布式系统中有并发问题你们怎么解决的，锁的结构是什么？
 数据的索引，你们数据表中的索引，挨个问了一下？
 延迟消息还可以用什么来做，定时任务的缺点？
 Canal + MQ 的和订单和座位表的流程，旧数据和新数据怎么去变更？
 假如是删除和替换有什么问题？
 12306 真的流量很大，Redis 集群也可能扛不住，怎么办？
 分库分表怎么分？库和表多少个？
 RocketMQ 的严格有序消息和局部有序消息？
 RocketMQ 的默认队列多少个？配置有序消息和局部有序消息？
 
美团：
 令牌分配具体的实现？
 进程同步的方式？
 在项目中具体怎么用的？
 消息队列的原理？
 Kafka 用过吗？
 延迟消息的原理？
 数据库的日志？
 Binlog 在项目中怎么用的？
 数据库和缓存一致怎么做的？
项目的数据库表如何设计？